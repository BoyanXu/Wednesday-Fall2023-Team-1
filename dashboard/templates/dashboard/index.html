{% extends 'base.html' %}

{% load static %}
{% block body_class %}background{% endblock %}

{% block content %}
    <div class="container mt-5">

        <div id="vibe-status" data-calculate-vibe-url="{% url 'dashboard:calculate_vibe' %}" class="border border-white rounded d-flex justify-content-center align-items-center vibe-background">
            <div class="vibe-loading-text"><h3>Loading Vibe...</h3></div>
            <div class="vibe-loaded-text" style="display: none;"><h3>Your vibe is</h3></div>
        </div>

        <br>

        <div class="border border-white rounded">
            <h3>Your top tracks:</h3>
            {% for track in tracks %}
            <p>{{ track.name }} - {{ track.artists }} ({{ track.album }})</p>
            {% endfor %}
        </div>

        <br>
        
        <div class="border border-white rounded">
            <h3>Recommendations based on your top tracks:</h3>
            {% for track in recommendedtracks %}
                <p>{{ track.name }} - {{ track.artists }} ({{ track.album }})</p>
            {% endfor %}
        </div>

        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script>
            $(document).ready(function() {
                var calculateVibeUrl = $('#vibe-status').data('calculate-vibe-url');
                $('#vibe-status').addClass('vibe-loading');
                $('#vibe-status .vibe-loading-text').show();
                $('#vibe-status .vibe-loaded-text').hide();
                $.ajax({
                    url: calculateVibeUrl,
                    type: 'GET',
                    success: function(data) {
                        if (data.result === "Null") {
                            $('#vibe-status .vibe-loaded-text').text('No songs to analyze.').show();
                            $('#vibe-status').removeClass('vibe-loading');
                        } else {
                            var dataAsH1 = $('<h1>').text(data.result);
                            $('#vibe-status .vibe-loaded-text').append(dataAsH1).show();
                            $('#vibe-status').removeClass('vibe-loading').addClass('vibe-loaded');
                        }
                        $('#vibe-status .vibe-loading-text').hide();
                        alert('Vibe loaded');
                    },
                    error: function() {
                        // If ajax function has error..
                        $('#vibe-status .vibe-loaded-text').text('Error, please try again later.').show();
                        $('#vibe-status').removeClass('vibe-loading');
                        $('#vibe-status .vibe-loading-text').hide();
                    }
                });
            });
        </script>

       <div class="container text-center">
            <div class="row">
                    <!-- Container for the Hour of Day Plot -->
                <div id="hourPlot" class="col"></div>

                <!-- Container for the Day of Week Plot -->
                <div id="dayPlot" class="col"></div>
            </div>
       </div>
        <script>
            document.addEventListener("DOMContentLoaded", function() {
                fetch('{% static "login/day_data.json" %}')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                const dayData = JSON.parse(data);
                Plotly.newPlot('dayPlot', dayData.data, dayData.layout);
            })
            .catch(error => {
                console.log('There was a problem with the fetch operation:', error.message);
            });
            // Your fetch and plot code here

                fetch('{% static "login/hour_data.json" %}')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                const hourData = JSON.parse(data);
                Plotly.newPlot('hourPlot', hourData.data, hourData.layout);
            })
            .catch(error => {
                console.log('There was a problem with the fetch operation:', error.message);
            });
        });
        </script>

        <!--
        <form action="{% url 'dashboard:logout' %}" method="post">
            {% csrf_token %}
            <input type="submit" value="Logout">
        </form>
        -->
    </div>


{% endblock %}